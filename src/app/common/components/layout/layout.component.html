<app-loader></app-loader>

<div class="d-flex flex-column vh-100">
  <!-- Header -->
  <header class="bg-primary text-white p-3 d-flex justify-content-between align-items-center">
    <h5 class="mb-0">CampusOrbit</h5>
    <div class="d-flex flex-column align-items-end">
      @if (loggedInUser()) {
        <h6 class="mb-0">{{ loggedInUser()?.fullName }}</h6>
        <h6 class="mb-0">{{ loggedInUser()?.enrollmentNumber }}</h6>
      }
      <button class="btn btn-light btn-sm mt-1" (click)="userService.logout()">Logout</button>
    </div>
  </header>

  <!-- Body -->
  <div class="d-flex flex-grow-1">
    <!-- Sidebar -->
    <nav class="sidebar bg-light border-end p-2"
         (mouseenter)="toggleSidebar(true)"
         (mouseleave)="toggleSidebar(false)"
         [class.sidebar-expanded]="sidebarExpanded()"
         [class.sidebar-collapsed]="!sidebarExpanded()">
      <ul class="nav flex-column">
        @for (module of sidebarData(); track module.moduleId) {
          <li class="nav-item mb-2">
            <div class="nav-link fw-bold d-flex justify-content-between align-items-center"
                 (click)="toggleModule(module.moduleId)">
              <div class="d-flex align-items-center flex-nowrap">
                <i class="{{ module.cssIcon }}"></i>
                <span class="sidebar-text ms-2"
                      [class.opacity-0]="!sidebarExpanded()"
                      [class.opacity-100]="sidebarExpanded()"
                      [class.pe-none]="!sidebarExpanded()">
                  {{ module.displayName }}
                </span>
              </div>
              @if (sidebarExpanded()) {
                <i class="bi"
                   [class.bi-chevron-down]="activeModuleId() === module.moduleId"
                   [class.bi-chevron-right]="activeModuleId() !== module.moduleId"></i>
              }
            </div>

            @if (activeModuleId() === module.moduleId && sidebarExpanded()) {
  <ul class="nav flex-column ms-3 mt-1">
    @for (route of module.routes; track route.path) {
      <li class="nav-item mb-1">
        <a class="nav-link" [routerLink]="route.path">
          <span class="sidebar-text text-truncate d-inline-block w-100"
                [attr.title]="route.displayName">
            {{ route.displayName }}
          </span>
        </a>
      </li>
    }
  </ul>
}

          </li>
        }
      </ul>
    </nav>

    <!-- Main content -->
    <main class="flex-grow-1 p-4">
      <router-outlet></router-outlet>
    </main>
  </div>

  <!-- Footer -->
  <footer class="bg-secondary text-white text-center p-2">
    &copy; 2025 Dhyey Sutariya
  </footer>
</div>
